# 微信小程序测试指南

## 测试环境准备

### 1. 微信开发者工具
- 下载并安装最新版本的微信开发者工具
- 使用微信扫码登录开发者工具
- 导入小程序项目（选择 `miniprogram` 目录）

### 2. H5页面服务
- 确保H5开发服务器正在运行：`npm run dev`
- 访问 http://localhost:5173 确认H5页面正常
- 检查移动端适配和微信环境检测功能

## 功能测试清单

### 基础功能测试

#### 1. 小程序启动测试
- [ ] 小程序能正常启动
- [ ] 首页界面正常显示
- [ ] tabBar导航正常显示
- [ ] 页面切换功能正常

#### 2. 用户授权测试
- [ ] 点击"获取用户信息"按钮
- [ ] 授权弹窗正常显示
- [ ] 授权成功后用户信息正常显示
- [ ] 用户头像和昵称正确显示

#### 3. WebView功能测试
- [ ] 点击"进入工时管理"按钮
- [ ] WebView页面正常加载
- [ ] H5页面在WebView中正常显示
- [ ] 页面加载状态正常显示
- [ ] 加载失败时错误页面正常显示

### 高级功能测试

#### 4. 双向通信测试
- [ ] 小程序向H5发送用户信息
- [ ] H5页面接收用户信息正常
- [ ] H5向小程序发送消息
- [ ] 小程序接收H5消息正常
- [ ] 消息格式和内容正确

#### 5. 环境检测测试
- [ ] 微信环境检测正常
- [ ] 小程序环境检测正常
- [ ] 移动端检测正常
- [ ] 设备类型识别正确

#### 6. 页面适配测试
- [ ] 不同屏幕尺寸适配正常
- [ ] 安全区域适配正常
- [ ] 横竖屏切换正常
- [ ] 字体大小适配正常

## 性能测试

### 1. 加载性能
- [ ] 小程序启动时间 < 3秒
- [ ] WebView加载时间 < 5秒
- [ ] 页面切换响应时间 < 1秒
- [ ] 网络请求响应时间合理

### 2. 内存使用
- [ ] 内存使用在合理范围内
- [ ] 长时间使用无内存泄漏
- [ ] 页面切换内存释放正常

### 3. 网络优化
- [ ] 网络请求合并优化
- [ ] 图片懒加载正常
- [ ] 缓存机制工作正常

## 兼容性测试

### 1. 微信版本兼容性
- [ ] 微信 8.0+ 版本正常
- [ ] 微信 7.0+ 版本正常
- [ ] 不同微信版本功能一致

### 2. 设备兼容性
- [ ] iOS设备正常运行
- [ ] Android设备正常运行
- [ ] 不同分辨率设备适配
- [ ] 低端设备性能可接受

### 3. 网络环境测试
- [ ] WiFi环境正常
- [ ] 4G网络正常
- [ ] 3G网络可用
- [ ] 弱网环境处理
- [ ] 断网重连机制

## 错误处理测试

### 1. 网络错误
- [ ] 网络断开时提示正常
- [ ] 请求超时处理正常
- [ ] 服务器错误提示正常
- [ ] 重试机制工作正常

### 2. 授权错误
- [ ] 用户拒绝授权处理
- [ ] 授权过期处理
- [ ] 权限不足提示

### 3. WebView错误
- [ ] 页面加载失败处理
- [ ] JavaScript错误处理
- [ ] 通信失败处理
- [ ] 页面崩溃恢复

## 安全测试

### 1. 数据安全
- [ ] 用户信息加密传输
- [ ] 敏感数据不在本地存储
- [ ] API接口安全验证
- [ ] 防止数据泄露

### 2. 权限安全
- [ ] 最小权限原则
- [ ] 权限使用说明清晰
- [ ] 用户隐私保护

## 测试工具和方法

### 1. 开发者工具
- 使用微信开发者工具的调试功能
- 查看Console日志
- 使用Network面板检查网络请求
- 使用Performance面板分析性能

### 2. 真机测试
- 使用微信开发者工具预览功能
- 扫码在真机上测试
- 不同设备和网络环境测试

### 3. 自动化测试
- 编写单元测试
- 集成测试脚本
- 性能监控脚本

## 常见问题排查

### 1. WebView加载失败
```javascript
// 检查H5服务是否启动
curl http://localhost:5173

// 检查域名白名单配置
// 确认 localhost:5173 已添加到业务域名
```

### 2. 用户信息获取失败
```javascript
// 检查授权状态
wx.getSetting({
  success: (res) => {
    console.log('授权状态:', res.authSetting)
  }
})
```

### 3. 通信失败
```javascript
// 检查消息格式
// H5发送消息格式
wx.miniProgram.postMessage({
  data: { type: 'test', message: 'hello' }
})

// 小程序接收消息
onMessage(e) {
  console.log('收到H5消息:', e.detail.data)
}
```

## 测试报告模板

### 测试概要
- 测试时间：
- 测试环境：
- 测试设备：
- 测试版本：

### 测试结果
- 通过项目数：
- 失败项目数：
- 阻塞问题：
- 性能指标：

### 问题列表
| 问题描述 | 严重程度 | 复现步骤 | 状态 |
|---------|---------|---------|------|
|         |         |         |      |

### 建议和改进
- 功能改进建议
- 性能优化建议
- 用户体验改进

## 发布前检查清单

- [ ] 所有功能测试通过
- [ ] 性能指标达标
- [ ] 兼容性测试通过
- [ ] 安全测试通过
- [ ] 域名白名单配置完成
- [ ] 版本信息更新
- [ ] 发布说明准备完成
- [ ] 审核材料准备完成

---

**注意事项：**
1. 测试过程中发现问题及时记录
2. 重要功能需要多设备验证
3. 性能测试需要在不同网络环境下进行
4. 安全测试不可忽视
5. 真机测试是必要的最后验证步骤