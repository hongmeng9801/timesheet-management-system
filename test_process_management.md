# 工序管理页面修复测试

## 修复内容

### 1. 数据库约束修复
- ✅ 修改了 `processes` 表的 `unit_price` 字段，允许 NULL 值
- ✅ 设置默认值为 NULL 而不是 0.00
- ✅ 添加了字段注释说明支持后续补充定价

### 2. 用户体验优化
- ✅ 添加了 `getDefaultCompanyId()` 函数，根据用户角色自动选择默认公司
- ✅ 修改了表单初始化逻辑，非超级管理员自动选择所属公司
- ✅ 修改了"清除内容"按钮，保留公司选择
- ✅ 修改了"取消"按钮，保留公司选择
- ✅ 修改了"添加工序"按钮，支持保留上次填写内容或初始化默认公司

### 3. 月末定价提示
- ✅ 在添加工序表单顶部添加了明显的蓝色提示框
- ✅ 提示内容："单价可以暂时不填写，支持在月末统计时补充定价"
- ✅ 单价输入框的 placeholder 也更新为"可在月末统计时定价"

### 4. 代码逻辑修复
- ✅ 修改了 `handleAddProcess` 函数中的单价处理逻辑
- ✅ 现在正确处理空字符串和 null 值：`formData.unit_price && formData.unit_price.trim() !== '' ? parseFloat(formData.unit_price) : null`

## 测试步骤

1. **测试单价为空的添加**
   - 打开工序管理页面
   - 点击"添加工序"按钮
   - 填写必填字段（公司、生产线、产品名称）
   - 不填写单价
   - 点击"确认添加"
   - 应该成功添加，不再出现 23502 错误

2. **测试默认公司选择**
   - 非超级管理员用户登录
   - 打开工序管理页面
   - 点击"添加工序"按钮
   - 公司字段应该自动选择用户所属公司

3. **测试清除内容功能**
   - 在添加工序表单中填写一些内容
   - 点击"清除内容"按钮
   - 其他字段应该被清空，但公司选择应该保留
   - 应该显示提示："表单内容已清除（保留公司选择）"

4. **测试月末定价提示**
   - 打开添加工序表单
   - 应该能看到蓝色的提示框
   - 提示内容应该清楚说明可以后续补充定价

## 预期结果

- ✅ 不再出现 "null value in column 'unit_price'" 错误
- ✅ 用户体验更加友好，减少重复填写
- ✅ 提示信息清晰，用户知道可以后续补充定价
- ✅ 所有功能正常工作